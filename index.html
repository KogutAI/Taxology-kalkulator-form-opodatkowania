<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<!-- Stylizacja: Tailwind CSS w trybie bezpiecznym (nie psuje strony WP) -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    corePlugins: {
      preflight: false, // Wyłącza reset stylów, aby nie zepsuć wyglądu Twojej strony WP
    },
    prefix: 'tw-', // Prefiks klas, aby nie kolidowały z motywem
    theme: {
      extend: {
        fontFamily: {
          sans: ['"Poppins"', 'sans-serif'], // Zmiana na Poppins
        },
        colors: {
          brand: {
            50: '#eff6ff',
            100: '#dbeafe',
            500: '#3b82f6',
            600: '#2563eb',
            700: '#1d4ed8',
          }
        },
        boxShadow: {
          'modern': '0 4px 20px -2px rgba(0, 0, 0, 0.05), 0 2px 10px -2px rgba(0, 0, 0, 0.02)', // Bardziej miękki cień
        }
      }
    }
  }
</script>

<!-- Ładowanie Fontu Poppins z Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Biblioteki React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
    /* Izolowany kontener dla kalkulatora */
    #tax-calculator-root-2026 {
        font-family: 'Poppins', sans-serif; /* Zastosowanie nowego fontu */
        background-color: #f8fafc;
        border-radius: 24px; /* Większe zaokrąglenie */
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.08); /* Nowoczesny, głęboki cień */
        padding: 32px;
        margin: 20px 0;
        color: #1e293b;
        line-height: 1.6;
    }
    
    /* Reset podstawowych elementów wewnątrz kalkulatora */
    #tax-calculator-root-2026 *, #tax-calculator-root-2026 ::before, #tax-calculator-root-2026 ::after {
        box-sizing: border-box;
        border-width: 0;
        border-style: solid;
        border-color: #e2e8f0;
    }

    /* Style formularzy - POPRAWIONE */
    #tax-calculator-root-2026 input[type="text"],
    #tax-calculator-root-2026 input[type="number"], 
    #tax-calculator-root-2026 select {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 0.95rem;
        font-family: 'Poppins', sans-serif;
        line-height: 1.5;
        border-radius: 0.75rem; /* Bardziej zaokrąglone inputy */
        border: 1px solid #e2e8f0;
        background-color: #ffffff;
        margin-top: 0.35rem;
        color: #0f172a;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        transition: all 0.2s ease;
    }

    /* Specyficzne paddingi dla inputów z walutą */
    #tax-calculator-root-2026 .currency-input input {
        padding-right: 2.5rem;
    }
    
    #tax-calculator-root-2026 input:focus, 
    #tax-calculator-root-2026 select:focus {
        outline: none;
        border-color: #6366f1; /* Zmiana na nowoczesny indygo */
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }
    
    #tax-calculator-root-2026 button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Segmented Control - Nowoczesne przyciski */
    .segmented-control {
        position: relative;
        display: flex;
        background-color: #f1f5f9;
        border-radius: 12px;
        padding: 4px;
        border: 1px solid #e2e8f0;
    }

    .segmented-control button {
        flex: 1;
        position: relative;
        z-index: 2;
        background: transparent;
        border: none;
        padding: 8px 12px;
        font-family: 'Poppins', sans-serif;
        font-size: 13px;
        font-weight: 500;
        color: #64748b;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 8px;
    }
    
    .segmented-control button:hover {
        color: #3b82f6;
    }

    .segmented-control button.active {
        color: #1e40af; /* Ciemny niebieski dla tekstu aktywnego */
        font-weight: 600;
    }

    /* Wskaźnik (tło aktywnego przycisku) - Jasnoniebieski */
    .segmented-control-indicator {
        position: absolute;
        top: 4px;
        left: 4px;
        width: calc(50% - 4px); /* Zakładamy 2 opcje */
        height: calc(100% - 8px);
        background-color: #dbeafe; /* Bardzo jasny niebieski */
        border: 1px solid #bfdbfe; /* Nieco ciemniejsza ramka */
        border-radius: 8px;
        z-index: 1;
        transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.05);
    }

    /* Klasa pomocnicza do liczb tabelarycznych */
    .tw-tabular-nums {
        font-variant-numeric: tabular-nums;
        letter-spacing: -0.02em; /* Lekkie zwężenie dla cyfr */
    }
</style>
</head>
<body>

<!-- Kontener aplikacji (Zmienione ID dla uniknięcia konfliktów) -->
<div id="tax-calculator-root-2026"></div>

<!-- Logika aplikacji -->
<script type="text/babel">
    const { useState, useMemo, useCallback, useEffect } = React;

    // --- 1. IKONY (Bez zmian) ---
    
    const CalculatorIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><line x1="8" x2="8" y1="14" y2="18"/><line x1="12" x2="12" y1="14" y2="18"/><line x1="8" x2="16" y1="10" y2="10"/></svg>
    );
    const DollarSignIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
    );
    const TrendingUpIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
    );
    const SettingsIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
    );
    const UsersIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    );
    
    const HeartIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
    );
    const ShieldIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
    );
    const TaxBadgeIcon = ({ size = 24, className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" x2="12" y1="18" y2="12"/><line x1="9" x2="15" y1="15" y2="15"/></svg>
    );

    // --- 2. STAŁE PODATKOWE (STAWKI NA 2026 ROK - ZNANE W GRUDNIU 2025) ---
    // Stan na grudzień 2025: Płaca minimalna i Prognozowane przeciętne wynagrodzenie (baza ZUS) są znane z Ustawy Budżetowej.
    const TAX_FREE_AMOUNT = 30000; // Kwota wolna
    const TAX_THRESHOLD = 120000; // Próg podatkowy
    const SOLIDARITY_THRESHOLD = 1000000;
    const SOLIDARITY_RATE = 0.04;

    // SKŁADKI ZUS NA 2026 (Wg Ustawy Budżetowej na 2026)
    const MONTHLY_ZUS_RATES = {
        duzy: 1950.00,         // ZUS Duży (z chorobowym, bez zdrowotnej) - wartość przykładowa (ok. 1950 zł w 2026)
        ulga: 0,               // Ulga na start
        preferencyjny: 485.00, // ZUS Preferencyjny (od podstawy 30% min. wynagrodzenia w 2026)
        maly_plus: 485.00,     // Mały ZUS Plus min.
    };

    // --- 3. FUNKCJE POMOCNICZE I LOGIKA (Bez zmian) ---
    
    const formatNumber = (num) => {
        if (num === null || isNaN(num)) return '0';
        return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    };

    const AnimatedNumber = ({ value }) => {
        const [displayValue, setDisplayValue] = useState(value);
        
        useEffect(() => {
            let startTimestamp = null;
            const startValue = displayValue;
            const duration = 1000; 

            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 4);
                
                const current = startValue + (value - startValue) * ease;
                setDisplayValue(current);
                
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            
            const frameId = window.requestAnimationFrame(step);
            return () => window.cancelAnimationFrame(frameId);
        }, [value]);

        return <span className="tw-tabular-nums">{formatNumber(displayValue)}</span>;
    };

    const calculateChildRelief = (count) => {
        if (!count || count <= 0) return 0;
        let relief = 0;
        if (count >= 1) relief += 1112.04;
        if (count >= 2) relief += 1112.04;
        if (count >= 3) relief += 2000.04;
        if (count >= 4) relief += (count - 3) * 2700.00;
        return relief;
    };

    const calculateScaleTaxValue = (income) => {
        let tax = 0;
        let taxAbove = 0; 
        const taxReductionAmount = 3600; 

        if (income <= TAX_FREE_AMOUNT) {
          tax = 0;
        } else if (income <= TAX_THRESHOLD) {
          tax = (income * 0.12) - taxReductionAmount;
        } else {
          const taxLevel1 = (TAX_THRESHOLD * 0.12) - taxReductionAmount;
          taxAbove = (income - TAX_THRESHOLD) * 0.32;
          tax = taxLevel1 + taxAbove;
        }
        return { total: Math.max(0, tax), above: Math.max(0, taxAbove) };
    };

    const calculateTaxes = (
        monthlyRevenue, 
        monthlyCosts, 
        ryczaltRate, 
        zusType, 
        isJointSettlement, 
        spouseMonthlyIncome,
        numberOfChildren
    ) => {
        const revenue = monthlyRevenue || 0;
        const costs = monthlyCosts || 0;
        const spouseIncome = spouseMonthlyIncome || 0;
        const childrenCount = numberOfChildren || 0;
        
        const annualRevenue = revenue * 12;
        const annualCosts = costs * 12;
        
        const monthlySocialZus = MONTHLY_ZUS_RATES[zusType];
        const annualSocialZus = monthlySocialZus * 12;
        
        const childRelief = calculateChildRelief(childrenCount);
        
        const results = [];

        // 1. SKALA PODATKOWA
        const scaleIncome = Math.max(0, annualRevenue - annualCosts - annualSocialZus);
        const scaleHealth = scaleIncome * 0.09; 
        let scaleTax = 0;
        let scaleTaxAbove = 0; 
        let scaleSolidarityTax = 0;

        if (isJointSettlement) {
          const annualSpouseIncome = spouseIncome * 12;
          const totalJointIncome = scaleIncome + annualSpouseIncome;
          const halfIncome = totalJointIncome / 2;
          
          const userTaxCalc = calculateScaleTaxValue(halfIncome);
          const totalJointTax = userTaxCalc.total * 2;
          const totalJointTaxAbove = userTaxCalc.above * 2;
          
          const spouseSoloCalc = calculateScaleTaxValue(annualSpouseIncome);
          
          scaleTax = Math.max(0, totalJointTax - spouseSoloCalc.total);
          scaleTaxAbove = Math.max(0, totalJointTaxAbove - spouseSoloCalc.above); 

          scaleTax = Math.max(0, scaleTax - childRelief);

          if (scaleIncome > SOLIDARITY_THRESHOLD) {
              scaleSolidarityTax = (scaleIncome - SOLIDARITY_THRESHOLD) * SOLIDARITY_RATE;
          }
        } else {
          const taxCalc = calculateScaleTaxValue(scaleIncome);
          scaleTax = taxCalc.total;
          scaleTaxAbove = taxCalc.above;
          
          scaleTax = Math.max(0, scaleTax - childRelief);

          if (scaleIncome > SOLIDARITY_THRESHOLD) {
              scaleSolidarityTax = (scaleIncome - SOLIDARITY_THRESHOLD) * SOLIDARITY_RATE;
          }
        }
        
        const finalScaleTax = scaleTax + scaleSolidarityTax;
        const scaleNet = annualRevenue - annualCosts - annualSocialZus - scaleHealth - finalScaleTax;

        results.push({ 
            id: 'skala', 
            name: isJointSettlement ? 'Skala podatkowa (Wspólne)' : 'Skala podatkowa', 
            net: scaleNet, 
            tax: finalScaleTax, 
            taxAbove: scaleTaxAbove, 
            solidarity: scaleSolidarityTax,
            health: scaleHealth,
            monthlyNet: scaleNet / 12,
            monthlyTax: finalScaleTax / 12,
            monthlyHealth: scaleHealth / 12,
            monthlySocialZus: monthlySocialZus,
            details: (isJointSettlement ? 'Z małżonkiem' : 'Zasady ogólne') + (childrenCount > 0 ? `, Dzieci: ${childrenCount}` : '') 
        });

        // 2. PODATEK LINIOWY
        const linearIncome = Math.max(0, annualRevenue - annualCosts - annualSocialZus);
        const linearHealth = linearIncome * 0.049; 
        const deductibleHealth = Math.min(linearHealth, 11600); 
        const linearTaxBase = Math.max(0, linearIncome - deductibleHealth);
        let linearTax = linearTaxBase * 0.19;
        let linearSolidarityTax = 0; 
        if (linearIncome > SOLIDARITY_THRESHOLD) {
            linearSolidarityTax = (linearIncome - SOLIDARITY_THRESHOLD) * SOLIDARITY_RATE;
        }
        linearTax += linearSolidarityTax;
        const linearNet = annualRevenue - annualCosts - annualSocialZus - linearHealth - linearTax;

        results.push({ 
            id: 'liniowy', 
            name: 'Podatek Liniowy (19%)', 
            net: linearNet, 
            tax: linearTax, 
            solidarity: linearSolidarityTax,
            health: linearHealth,
            monthlyNet: linearNet / 12,
            monthlyTax: linearTax / 12,
            monthlyHealth: linearHealth / 12,
            monthlySocialZus: monthlySocialZus,
            details: 'Stała stawka 19%. Brak możliwości wspólnego rozliczenia.' 
        });

        // 3. RYCZAŁT
        const ryczaltTaxBase = Math.max(0, annualRevenue - annualSocialZus);
        const ryczaltTax = ryczaltTaxBase * (ryczaltRate / 100);
        const ryczaltSolidarityTax = 0; 

        let monthlyRyczaltHealth = 0;
        if (annualRevenue < 60000) monthlyRyczaltHealth = 419; // Zakładamy brak zmian w progach zdrowotnych
        else if (annualRevenue < 300000) monthlyRyczaltHealth = 699;
        else monthlyRyczaltHealth = 1258;
        
        const annualRyczaltHealth = monthlyRyczaltHealth * 12;
        const ryczaltNet = annualRevenue - annualCosts - annualSocialZus - annualRyczaltHealth - ryczaltTax;
        
        results.push({ 
            id: 'ryczalt', 
            name: `Ryczałt (${ryczaltRate}%)`, 
            net: ryczaltNet, 
            tax: ryczaltTax, 
            solidarity: ryczaltSolidarityTax,
            health: annualRyczaltHealth,
            monthlyNet: ryczaltNet / 12,
            monthlyTax: ryczaltTax / 12,
            monthlyHealth: monthlyRyczaltHealth, 
            monthlySocialZus: monthlySocialZus,
            details: 'Opodatkowanie od przychodu.' 
        });
        
        return results.sort((a, b) => b.net - a.net);
    };

    // --- 4. GŁÓWNY KOMPONENT ---
    function TaxCalculator2026() {
      const [monthlyRevenue, setMonthlyRevenue] = useState(10000); 
      const [monthlyCosts, setMonthlyCosts] = useState(0);
      const [ryczaltRate, setRyczaltRate] = useState(12);
      const [zusType, setZusType] = useState('duzy');
      const [isJointSettlement, setIsJointSettlement] = useState(false);
      const [spouseMonthlyIncome, setSpouseMonthlyIncome] = useState(null);
      const [numberOfChildren, setNumberOfChildren] = useState(0); 

      const [inputMode, setInputMode] = useState('monthly'); 
      
      const monthlyRevenueCalc = useMemo(() => {
          if (monthlyRevenue === null) return 0;
          return inputMode === 'monthly' ? monthlyRevenue : monthlyRevenue / 12;
      }, [monthlyRevenue, inputMode]);

      const monthlyCostsCalc = useMemo(() => {
          if (monthlyCosts === null) return 0;
          return inputMode === 'monthly' ? monthlyCosts : monthlyCosts / 12;
      }, [monthlyCosts, inputMode]);

      const hasInputCalc = useMemo(() => monthlyRevenueCalc !== null && monthlyRevenueCalc >= 0, [monthlyRevenueCalc]);
      
      const resultsCalc = useMemo(() => {
        if (!hasInputCalc) return [];
        return calculateTaxes(
            monthlyRevenueCalc, 
            monthlyCostsCalc, 
            ryczaltRate, 
            zusType, 
            isJointSettlement, 
            spouseMonthlyIncome,
            numberOfChildren
        );
      }, [monthlyRevenueCalc, monthlyCostsCalc, ryczaltRate, zusType, isJointSettlement, spouseMonthlyIncome, numberOfChildren]);
      
      const bestOptionCalc = resultsCalc[0] || {};
      const totalAnnualRevenueCalc = monthlyRevenueCalc * 12;
      const totalAnnualCostsCalc = monthlyCostsCalc * 12;
      const totalAnnualIncomeCalc = totalAnnualRevenueCalc - totalAnnualCostsCalc;

      const handleModeChange = (newMode) => {
          if (newMode === inputMode) return;
          if (monthlyRevenue !== null) {
              setMonthlyRevenue(newMode === 'yearly' ? monthlyRevenue * 12 : monthlyRevenue / 12);
          }
          if (monthlyCosts !== null) {
              setMonthlyCosts(newMode === 'yearly' ? monthlyCosts * 12 : monthlyCosts / 12);
          }
          setInputMode(newMode);
      };

      const formatCurrencyInput = (val) => {
          if (val === null || val === undefined) return '';
          return Math.round(val).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
      };

      const handleCurrencyChange = (e, setter) => {
        const value = e.target.value.replace(/\s/g, ''); 
        if (value === '') {
            setter(null);
        } else if (!isNaN(value)) {
            setter(Number(value));
        }
      };

      return (
        <div className="tw-min-h-screen tw-bg-slate-50 tw-p-4 md:tw-p-8">
          {/* ZMIANA 1: Szerokość max-w-[90rem] */}
          <div className="tw-max-w-[90rem] tw-mx-auto">
            
            {/* Header */}
            <header className="tw-mb-8 tw-text-center md:tw-text-left tw-flex tw-items-center tw-gap-4">
              <div className="tw-bg-gradient-to-br tw-from-indigo-500 tw-to-indigo-700 tw-p-3 tw-rounded-xl tw-shadow-lg tw-text-white">
                <CalculatorIcon size={32} />
              </div>
              <div>
                {/* ZMIANA NAGŁÓWKA NA 2026 - USUNIĘTO "PROGNOZA" */}
                <h1 className="tw-text-3xl tw-font-extrabold tw-text-slate-900 tw-m-0 tw-tracking-tight">Kalkulator Podatkowy 2026</h1>
                <p className="tw-text-slate-500 tw-m-0 tw-font-medium">Porównaj formy opodatkowania (Stawki wg budżetu 2026)</p>
              </div>
            </header>

            <div className="tw-grid tw-grid-cols-1 lg:tw-grid-cols-12 tw-gap-8">
              
              {/* LEWA KOLUMNA: PANELE KONFIGURACJI */}
              <div className="lg:tw-col-span-3 tw-flex tw-flex-col tw-gap-6 tw-h-full">
                
                {/* Panel 1: Parametry */}
                <div className="tw-bg-white tw-p-6 tw-rounded-2xl tw-shadow-modern tw-border tw-border-slate-100 tw-transition-all hover:tw-shadow-modern-lg tw-flex-1 tw-flex tw-flex-col">
                  <div className="tw-flex tw-justify-between tw-items-center tw-mb-4">
                      <h2 className="tw-text-base tw-font-bold tw-flex tw-items-center tw-gap-3 tw-text-slate-800 tw-m-0">
                        <div className="tw-p-2 tw-rounded-xl tw-bg-blue-100 tw-text-blue-600 tw-shadow-sm">
                           <DollarSignIcon size={20} />
                        </div>
                        Parametry Finansowe
                      </h2>
                  </div>
                  
                  <div className="segmented-control tw-mb-5">
                      <div className="segmented-control-indicator" style={{ transform: inputMode === 'monthly' ? 'translateX(0)' : 'translateX(100%)' }}></div>
                      <button onClick={() => handleModeChange('monthly')} className={inputMode === 'monthly' ? 'active' : ''}>Miesięcznie</button>
                      <button onClick={() => handleModeChange('yearly')} className={inputMode === 'yearly' ? 'active' : ''}>Rocznie</button>
                  </div>

                  <div className="tw-grid tw-grid-cols-2 tw-gap-4">
                    <div>
                      <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Przychód</label>
                      <div className="tw-relative currency-input">
                        <input type="text" inputMode="numeric" value={formatCurrencyInput(monthlyRevenue)} onChange={(e) => handleCurrencyChange(e, setMonthlyRevenue)} placeholder="0" className="tw-w-full tw-pr-10 tw-font-semibold tw-text-slate-700" />
                        <span className="tw-absolute tw-right-3 tw-top-1/2 tw-transform tw--translate-y-1/2 tw-text-slate-400 tw-text-xs tw-font-medium">zł</span>
                      </div>
                    </div>
                    <div>
                      <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Koszty</label>
                      <div className="tw-relative currency-input">
                        <input type="text" inputMode="numeric" value={formatCurrencyInput(monthlyCosts)} onChange={(e) => handleCurrencyChange(e, setMonthlyCosts)} placeholder="0" className="tw-w-full tw-pr-10 tw-font-semibold tw-text-slate-700" />
                        <span className="tw-absolute tw-right-3 tw-top-1/2 tw-transform tw--translate-y-1/2 tw-text-slate-400 tw-text-xs tw-font-medium">zł</span>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Panel 2: Ustawienia */}
                <div className="tw-bg-white tw-p-6 tw-rounded-2xl tw-shadow-modern tw-border tw-border-slate-100 tw-transition-all hover:tw-shadow-modern-lg tw-flex-1 tw-flex tw-flex-col">
                  <h2 className="tw-text-base tw-font-bold tw-mb-4 tw-flex tw-items-center tw-gap-3 tw-text-slate-800">
                    <div className="tw-p-2 tw-rounded-xl tw-bg-purple-100 tw-text-purple-600 tw-shadow-sm">
                        <SettingsIcon size={20} />
                    </div>
                    Ustawienia Podatkowe
                  </h2>
                  <div className="tw-space-y-4">
                    <div>
                      <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Rodzaj ZUS (2026)</label>
                      <select value={zusType} onChange={(e) => setZusType(e.target.value)} className="tw-font-medium tw-text-slate-700">
                        <option value="duzy">Pełny ZUS + FP (~1950 zł)</option>
                        <option value="ulga">Ulga na start (0 zł)</option>
                        <option value="preferencyjny">ZUS Preferencyjny (~485 zł)</option>
                        <option value="maly_plus">Mały ZUS Plus</option>
                      </select>
                       <p className="tw-text-[10px] tw-text-slate-400 tw-mt-1.5 tw-font-medium">Wartości bazowe z Ustawy Budżetowej na 2026 r.</p>
                    </div>
                    <div>
                      <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Stawka Ryczałtu</label>
                      <select value={ryczaltRate} onChange={(e) => setRyczaltRate(Number(e.target.value))} className="tw-font-medium tw-text-slate-700">
                        <option value={17}>17% - Wolne zawody</option>
                        <option value={15}>15% - IT, Doradztwo</option>
                        <option value={14}>14% - Inżynieria, Zdrowie</option>
                        <option value={12}>12% - IT: Programiści</option>
                        <option value={8.5}>8.5% - Usługi, Najem</option>
                        <option value={5.5}>5.5% - Budowlanka</option>
                        <option value={3}>3.0% - Handel</option>
                      </select>
                    </div>
                  </div>
                </div>

                {/* Panel 3: Rodzina */}
                <div className="tw-bg-white tw-p-6 tw-rounded-2xl tw-shadow-modern tw-border tw-border-slate-100 tw-transition-all hover:tw-shadow-modern-lg tw-flex-1 tw-flex tw-flex-col">
                   <h2 className="tw-text-base tw-font-bold tw-mb-4 tw-flex tw-items-center tw-gap-3 tw-text-slate-800">
                    <div className="tw-p-2 tw-rounded-xl tw-bg-emerald-100 tw-text-emerald-600 tw-shadow-sm">
                        <UsersIcon size={20} />
                    </div>
                    Rodzina
                  </h2>
                  
                  {/* UKŁAD GRID DLA RODZINY (ZACHOWANY) */}
                  <div className="tw-grid tw-grid-cols-2 tw-gap-4 tw-items-end">
                      
                      <div className={`tw-flex tw-items-center tw-justify-between tw-bg-slate-50 tw-p-3 tw-rounded-xl tw-border tw-border-slate-200 ${isJointSettlement ? 'tw-col-span-2' : ''}`}>
                          <span className="tw-text-sm tw-font-semibold tw-text-slate-700">Wspólne rozliczenie</span>
                          <div onClick={() => setIsJointSettlement(!isJointSettlement)} className={`tw-w-11 tw-h-6 tw-rounded-full tw-p-0.5 tw-cursor-pointer tw-transition-colors tw-duration-300 ${isJointSettlement ? 'tw-bg-emerald-500' : 'tw-bg-slate-300'}`}>
                            <div className={`tw-w-5 tw-h-5 tw-rounded-full tw-bg-white tw-shadow-sm tw-transform tw-transition-transform tw-duration-300 ${isJointSettlement ? 'tw-translate-x-5' : 'tw-translate-x-0'}`} />
                          </div>
                      </div>

                      {isJointSettlement && (
                        <div className="tw-animate-in tw-slide-in-from-left-2 tw-duration-200">
                          <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Dochód małżonka</label>
                          <div className="tw-relative currency-input">
                              <input type="text" inputMode="numeric" value={formatCurrencyInput(spouseMonthlyIncome)} onChange={(e) => handleCurrencyChange(e, setSpouseMonthlyIncome)} placeholder="0" className="tw-w-full tw-pr-10 tw-font-semibold tw-text-slate-700" />
                              <span className="tw-absolute tw-right-3 tw-top-1/2 tw-transform tw--translate-y-1/2 tw-text-slate-400 tw-text-xs tw-font-medium">zł</span>
                          </div>
                        </div>
                      )}

                      <div>
                        <label className="tw-block tw-text-[11px] tw-font-bold tw-text-slate-500 tw-uppercase tw-tracking-wider tw-mb-1.5">Liczba dzieci</label>
                        <select value={numberOfChildren} onChange={(e) => setNumberOfChildren(Number(e.target.value))} className="tw-w-full tw-font-medium tw-text-slate-700">
                            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (<option key={num} value={num}>{num}</option>))}
                        </select>
                      </div>

                  </div>
                  
                  {(isJointSettlement || numberOfChildren > 0) && (
                      <p className="tw-text-[10px] tw-text-slate-400 tw-mt-3 tw-italic tw-font-medium">Ulgi te dotyczą tylko Skali Podatkowej.</p>
                  )}
                </div>
              </div>

              {/* PRAWA KOLUMNA: WYNIKI */}
              <div className="lg:tw-col-span-9 tw-space-y-6">
                 
                 {!hasInputCalc && (
                    <div className="tw-bg-white tw-p-12 tw-rounded-2xl tw-shadow-lg tw-border tw-border-slate-100 tw-text-center tw-text-slate-500 tw-flex tw-flex-col tw-items-center tw-justify-center tw-h-full">
                        <CalculatorIcon size={64} className="tw-mb-4 tw-text-blue-300" />
                        <h3 className="tw-text-xl tw-font-semibold tw-text-slate-700 tw-mb-2">Wprowadź dane (2026)</h3>
                        <p className="tw-font-medium">Wpisz prognozowany przychód i koszty w panelu po lewej stronie.</p>
                    </div>
                 )}

                 {hasInputCalc && (
                 <div className="tw-grid tw-grid-cols-1 md:tw-grid-cols-3 tw-gap-4">
                    {resultsCalc.map((result, index) => {
                      const isBest = index === 0;
                      const incomeTaxOnly = result.tax - result.solidarity;
                      
                      const totalPublicBurden = incomeTaxOnly + result.health + (result.monthlySocialZus * 12) + result.solidarity;
                      const effectiveTaxRate = totalAnnualRevenueCalc > 0 ? (totalPublicBurden / totalAnnualRevenueCalc) * 100 : 0;
                      
                      const diff = bestOptionCalc.net - result.net;

                      return (
                        <div key={result.id} className={`tw-flex tw-flex-col tw-bg-white tw-rounded-2xl tw-border-2 tw-transition-all tw-duration-300 tw-relative tw-overflow-hidden ${isBest ? 'tw-border-emerald-500 tw-shadow-xl tw-scale-[1.02] tw-z-10' : 'tw-border-slate-100 tw-shadow-sm hover:tw-border-slate-300'}`}>
                          
                          {/* KAFELEK HEADER - STAŁA WYSOKOŚĆ (ZACHOWANA) */}
                          <div className={`tw-p-4 tw-h-24 tw-flex tw-flex-col tw-justify-between ${isBest ? 'tw-bg-emerald-50' : 'tw-bg-white'} tw-border-b tw-border-slate-100`}>
                              <div className="tw-flex tw-justify-between tw-items-start">
                                  <h4 className={`tw-font-bold tw-text-base tw-leading-tight ${isBest ? 'tw-text-emerald-800' : 'tw-text-slate-800'}`}>
                                    {result.name.replace(' (Wspólne)', '').replace('Podatkowa', '')}
                                    {result.id === 'skala' && isJointSettlement && <span className="tw-block tw-text-[10px] tw-font-normal tw-text-emerald-700">Wspólne rozliczenie</span>}
                                  </h4>
                                  {isBest && <span className="tw-bg-emerald-500 tw-text-white tw-text-[10px] tw-uppercase tw-font-bold tw-px-2 tw-py-0.5 tw-rounded-full tw-shadow-sm tw-whitespace-nowrap tw-ml-2">Najlepsza</span>}
                              </div>
                              <div className={`tw-mt-1 tw-text-[10px] tw-font-bold tw-px-2 tw-py-1 tw-rounded tw-border tw-w-max ${diff > 0 ? 'tw-text-red-600 tw-bg-red-50 tw-border-red-100' : 'tw-invisible tw-border-transparent'}`}>
                                  {diff > 0 ? <>+ <AnimatedNumber value={diff} /> zł rocznie</> : '-'}
                              </div>
                          </div>

                          {/* GŁÓWNY WYNIK - STAŁA WYSOKOŚĆ (ZACHOWANA) */}
                          <div className="tw-p-5 tw-text-center tw-h-36 tw-flex tw-flex-col tw-justify-center">
                              <div className="tw-text-[10px] tw-font-bold tw-text-slate-400 tw-uppercase tw-tracking-wider tw-mb-1">Na rękę (mies.)</div>
                              <div className={`tw-text-3xl tw-font-extrabold ${isBest ? 'tw-text-emerald-600' : 'tw-text-slate-800'}`}>
                                <AnimatedNumber value={result.monthlyNet} /> <span className="tw-text-base tw-font-medium">zł</span>
                              </div>
                              <div className="tw-text-xs tw-text-slate-400 tw-mt-1 tw-font-medium">
                                Rocznie: <AnimatedNumber value={result.net} /> zł
                              </div>
                          </div>

                          {/* SZCZEGÓŁY MIESIĘCZNE - UKŁAD PIONOWY (ZACHOWANY) */}
                          <div className="tw-px-5 tw-pb-4 tw-space-y-2 tw-text-xs tw-flex-1">
                             <div className="tw-flex tw-justify-between tw-items-center tw-border-b tw-border-slate-100 tw-pb-1 tw-h-7">
                               <span className="tw-text-slate-500 tw-flex tw-items-center tw-gap-1.5 tw-truncate tw-mr-2"><TaxBadgeIcon size={14} className="tw-text-red-400 tw-flex-shrink-0"/> Podatek (PIT)</span>
                               <span className="tw-font-semibold tw-text-slate-700 tw-whitespace-nowrap"><AnimatedNumber value={incomeTaxOnly / 12} /> zł</span>
                             </div>
                             <div className="tw-flex tw-justify-between tw-items-center tw-border-b tw-border-slate-100 tw-pb-1 tw-h-7">
                               <span className="tw-text-slate-500 tw-flex tw-items-center tw-gap-1.5 tw-truncate tw-mr-2"><HeartIcon size={14} className="tw-text-blue-400 tw-flex-shrink-0"/> Składka zdrowotna (NFZ)</span>
                               <span className="tw-font-semibold tw-text-slate-700 tw-whitespace-nowrap"><AnimatedNumber value={result.monthlyHealth} /> zł</span>
                             </div>
                             <div className="tw-flex tw-items-center tw-justify-between tw-border-b tw-border-slate-100 tw-pb-1 tw-h-7">
                               <span className="tw-text-slate-500 tw-flex tw-items-center tw-gap-1.5 tw-truncate tw-mr-2"><ShieldIcon size={14} className="tw-text-yellow-500 tw-flex-shrink-0"/> Społeczne ZUS</span>
                               <span className="tw-font-semibold tw-text-slate-700 tw-whitespace-nowrap"><AnimatedNumber value={result.monthlySocialZus} /> zł</span>
                             </div>
                          </div>
                          
                          {/* PODSUMOWANIE ROCZNE */}
                          <div className="tw-bg-slate-50 tw-p-4 tw-mt-auto tw-border-t tw-border-slate-100">
                              <p className="tw-text-[10px] tw-uppercase tw-font-bold tw-text-slate-400 tw-mb-2">Podsumowanie roczne</p>
                              <div className="tw-space-y-1 tw-text-[11px]">
                                  <div className="tw-flex tw-justify-between">
                                      <span className="tw-text-slate-500">Przychód:</span>
                                      <span className="tw-text-slate-800"><AnimatedNumber value={totalAnnualRevenueCalc} /> zł</span>
                                  </div>
                                  <div className="tw-flex tw-justify-between">
                                      <span className="tw-text-slate-500">Koszty:</span>
                                      <span className="tw-text-slate-800"><AnimatedNumber value={totalAnnualCostsCalc} /> zł</span>
                                  </div>
                                  <div className="tw-flex tw-justify-between">
                                      <span className="tw-text-slate-500">Społeczne ZUS:</span>
                                      <span className="tw-text-slate-800"><AnimatedNumber value={result.monthlySocialZus * 12} /> zł</span>
                                  </div>
                                  <div className="tw-flex tw-justify-between">
                                      <span className="tw-text-slate-500">Składka zdrowotna (NFZ):</span>
                                      <span className="tw-text-slate-800"><AnimatedNumber value={result.health} /> zł</span>
                                  </div>
                                  
                                  <div className="tw-flex tw-justify-between tw-pt-1">
                                      <span className="tw-text-slate-500">Podatek (PIT):</span>
                                      <span className="tw-text-slate-800 tw-text-right">
                                          <AnimatedNumber value={incomeTaxOnly} /> zł
                                          {result.taxAbove > 0 && (
                                              <span className="tw-block tw-text-[9px] tw-text-red-500">
                                                w tym <AnimatedNumber value={result.taxAbove} /> zł (32%)
                                              </span>
                                          )}
                                      </span>
                                  </div>
                                  {result.solidarity > 0 && (
                                    <div className="tw-flex tw-justify-between tw-text-red-600">
                                      <span>Danina solidarnościowa:</span>
                                      <span><AnimatedNumber value={result.solidarity} /></span>
                                    </div>
                                  )}

                                  <div className="tw-border-t tw-border-slate-200 tw-mt-2 tw-pt-2"></div>
                                  <div className="tw-flex tw-justify-between tw-items-baseline">
                                      <span className="tw-text-slate-600 tw-font-semibold">Dochód roczny (na rękę):</span>
                                      <span className="tw-text-emerald-700 tw-font-bold tw-text-sm tw-whitespace-nowrap"><AnimatedNumber value={result.net} /> zł</span>
                                  </div>

                                  <div className="tw-flex tw-justify-between tw-pt-2 tw-mt-1 tw-border-t tw-border-slate-200">
                                      <span className="tw-text-slate-500">Efektywne opodatkowanie:</span>
                                      <span className="tw-font-bold tw-text-indigo-600"><AnimatedNumber value={effectiveTaxRate} />%</span>
                                  </div>
                              </div>
                          </div>

                          {/* Pasek wizualny */}
                          <div className="tw-h-1.5 tw-w-full tw-flex">
                             <div className="tw-bg-emerald-500" style={{ width: `${(result.net / totalAnnualRevenueCalc) * 100}%` }}></div>
                             <div className="tw-bg-red-400" style={{ width: `${(result.tax / totalAnnualRevenueCalc) * 100}%` }}></div>
                             <div className="tw-bg-blue-400" style={{ width: `${(result.health / totalAnnualRevenueCalc) * 100}%` }}></div>
                             <div className="tw-bg-yellow-500" style={{ width: `${(result.monthlySocialZus * 12 / totalAnnualRevenueCalc) * 100}%` }}></div>
                          </div>
                        </div>
                      );
                    })}
                 </div>
                 )}
              </div>
            </div>
            
          </div>
        </div>
      );
    }

    const container2026 = document.getElementById('tax-calculator-root-2026');
    const root2026 = ReactDOM.createRoot(container2026);
    root2026.render(React.createElement(TaxCalculator2026));
</script>
</body>
</html>
